{
  "hash": "4cabbe5a84b9d6cf54a6df98f92dc274",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Houston Blackouts Mapping\"\nauthor: \"Leilanie Rubinstein\"\ndate: \"2024-12-09\"\ndescription: \"Identifying impacts of extreme weather on the Texas power grid\"\ncategories: [R, Spatial Analysis, Remote Sensing, Energy]\nformat: \n  html: \n    embed-resources: true\n    code-fold: true\neditor_options: \n  chunk_output_type: console\nexecute: \n  warning: false\n  message: false\n  freeze: true\ndraft: false\n---\n\n\n\n# Identifying the impacts of extreme weather\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Load all packages\nlibrarian::shelf(\n  tidyverse,\n  sf,\n  terra,\n  stars,\n  raster,\n  tidyterra,\n  tmap,\n  viridis,\n  patchwork,\n  scales,\n  kableExtra,\n  janitor,\n  here,\n  testthat\n)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n# Import night lights data\nnight_lights1 <- terra::rast(here::here(\"posts/2024-12-09-houston-blackout-visualization\",\"data\", \"VNP46A1/VNP46A1.A2021038.h08v05.001.2021039064328.tif\"))\nnight_lights2 <- terra::rast(here::here(\"posts/2024-12-09-houston-blackout-visualization\", \"data\", \"VNP46A1/VNP46A1.A2021038.h08v06.001.2021039064329.tif\"))\nnight_lights3 <- terra::rast(here::here(\"posts/2024-12-09-houston-blackout-visualization\", \"data\", \"VNP46A1/VNP46A1.A2021047.h08v05.001.2021048091106.tif\"))\nnight_lights4 <- terra::rast(here::here(\"posts/2024-12-09-houston-blackout-visualization\", \"data\", \"VNP46A1/VNP46A1.A2021047.h08v06.001.2021048091105.tif\"))\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n# Merge and process night lights data, cropping to the Houston area\nhouston_extent <- extent(c(-96.5, -94.5, 29, 30.5))\n\n# Check if CRS matches before merging\nif (crs(night_lights1) != crs(night_lights2)) {\n  stop(\"CRS does not match between night_lights1 and night_lights2\")\n}\nif (crs(night_lights3) != crs(night_lights4)) {\n  stop(\"CRS does not match between night_lights3 and night_lights4\")\n}\n\nnight_lights_before <- terra::merge(night_lights1, night_lights2) %>%\n  crop(houston_extent)\nnight_lights_after <- terra::merge(night_lights3, night_lights4) %>%\n  crop(houston_extent)\n\n# Create blackout mask\nnight_lights_change <- night_lights_after - night_lights_before\nnight_lights_change[night_lights_change > -200] <- NA\n\n\n# Vectorize blackout mask\nnight_lights_change_poly <- as.polygons(night_lights_change) %>%\n  st_as_sf() %>%\n  st_make_valid() %>%\n  st_transform(crs = \"EPSG:3083\")\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n# Import infrastructure data\nroads <- read_sf(here::here(\"posts/2024-12-09-houston-blackout-visualization\",\n                            \"data\", \"gis_osm_roads_free_1.gpkg\"), \n                 query = \"SELECT * FROM gis_osm_roads_free_1 WHERE fclass='motorway'\") %>%\n  st_transform(crs = \"EPSG:3083\")\n\nhouses <- read_sf(here::here(\"posts/2024-12-09-houston-blackout-visualization\",\n                             \"data\", \"gis_osm_buildings_a_free_1.gpkg\"),\n                  query = \"SELECT * FROM gis_osm_buildings_a_free_1 \n                         WHERE (type IS NULL AND name IS NULL)\n                         OR type in ('residential', 'apartments', 'house', 'static_caravan', 'detached')\") %>%\n  st_transform(crs = \"EPSG:3083\")\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n# Create road buffer and exclude highways from blackout mask\nroads_buffer <- st_buffer(roads, dist = 200)\nblackouts_200m <- st_difference(night_lights_change_poly, st_union(roads_buffer))\n\ntm_shape(blackouts_200m) +\n  tm_polygons() + \n  tm_layout(main.title = \"Blackout Mask\")\n```\n\n::: {.cell-output-display}\n![](houston-blackouts_files/figure-html/unnamed-chunk-5-1.png){width=672}\n:::\n:::\n\n\n\n## Create a set of maps comparing night light intensities before and after the storms\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Calculate common min and max for both rasters after log1p transformation\nmin_val <- min(c(values(log1p(night_lights_before)), \n                 values(log1p(night_lights_after))), na.rm = TRUE)\nmax_val <- max(c(values(log1p(night_lights_before)), \n                 values(log1p(night_lights_after))), na.rm = TRUE)\n\np1 <- ggplot() +\n geom_spatraster(data = log1p(night_lights_before)) +\n scale_fill_viridis_c(name = \"Light Intensity\\nlog1p(nW/cm²/sr)\", \n                      option = \"plasma\",\n                      limits = c(min_val, max_val),\n                      na.value = \"transparent\",\n                      guide = guide_colorbar(\n                        title.position = \"top\",\n                        title.hjust = 0.5,\n                        barwidth = 1.2,\n                        barheight = 15,\n                        frame.colour = \"black\",\n                        frame.linewidth = 0.5,\n                        ticks.colour = \"black\"\n                      )) +\n labs(title = \"Nighttime Light Intensity\",\n      subtitle = \"Before Storm (February 7, 2021)\") +\n theme_void() +\n theme(plot.title = element_text(hjust = 0.5, size = 14, face = \"bold\"),\n       plot.subtitle = element_text(hjust = 0.5, size = 10),\n       legend.position = \"right\")\n\np2 <- ggplot() +\n geom_spatraster(data = log1p(night_lights_after)) +\n scale_fill_viridis_c(name = \"Light Intensity\\nlog1p(nW/cm²/sr)\", \n                      option = \"plasma\",\n                      limits = c(min_val, max_val),\n                      na.value = \"transparent\") +\n labs(title = \"Nighttime Light Intensity\",\n      subtitle = \"After Storm (February 16, 2021)\") +\n theme_void() +\n theme(plot.title = element_text(hjust = 0.5, size = 14, face = \"bold\"),\n       plot.subtitle = element_text(hjust = 0.5, size = 10),\n       legend.position = \"none\")\n\n# Combine plots with vertical legend between them\np1 + p2 + plot_layout(guides = \"collect\")\n```\n\n::: {.cell-output-display}\n![](houston-blackouts_files/figure-html/unnamed-chunk-6-1.png){width=672}\n:::\n:::\n\n\n\n## Create a map of the homes in Houston that lost power\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# houses_filtered <- houses[blackouts_200m, ]\n\n# Convert blackouts to a raster/stars object\nblackouts_raster <- st_rasterize(blackouts_200m, \n                                 dx = 100, \n                                 dy = 100)\n\n# Convert houses to points (centroids) for faster processing\nhouses_points <- st_centroid(houses)\n\n# Extract values at house locations\nhouse_values <- st_extract(blackouts_raster, houses_points)\n\n# Filter houses based on extracted values\nhouses_filtered <- houses[!is.na(house_values[[1]]), ]\n\ntm_shape(houses_filtered) +\n  tm_dots(col = \"#CBC3E3\") +\n  tm_compass(type = \"8star\",\n             size = 0.8) +\n  tm_scale_bar() +\n  tm_layout(main.title = \"Homes in Houston that Lost Power\")\n```\n\n::: {.cell-output-display}\n![](houston-blackouts_files/figure-html/unnamed-chunk-7-1.png){width=672}\n:::\n:::\n\n\n\n## Estimate the number of homes in Houston that lost power\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nnrow(houses_filtered)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 153745\n```\n\n\n:::\n\n```{.r .cell-code}\nhouses_count <- houses_filtered %>%\n  group_by(type) %>%\n  summarize(count = n()) %>%\n  ungroup() %>%\n  st_drop_geometry()\n\n# Check that the sum of buildings adds up to the number of rows in `houses_filtered` \ntestthat::expect_equal(sum(houses_count$count), nrow(houses_filtered))\n\nhouses_count_table <- houses_count %>%\n  kbl(caption = \"Number of homes that experienced power loss (total = 157967)\") %>%\n  kable_classic(html_font = \"Cambria\")\n\nhouses_count_table\n```\n\n::: {.cell-output-display}\n`````{=html}\n<table class=\" lightable-classic\" style=\"font-family: Cambria; margin-left: auto; margin-right: auto;\">\n<caption>Number of homes that experienced power loss (total = 157967)</caption>\n <thead>\n  <tr>\n   <th style=\"text-align:left;\"> type </th>\n   <th style=\"text-align:right;\"> count </th>\n  </tr>\n </thead>\n<tbody>\n  <tr>\n   <td style=\"text-align:left;\"> apartments </td>\n   <td style=\"text-align:right;\"> 1072 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> detached </td>\n   <td style=\"text-align:right;\"> 344 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> house </td>\n   <td style=\"text-align:right;\"> 19338 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> residential </td>\n   <td style=\"text-align:right;\"> 1324 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> static_caravan </td>\n   <td style=\"text-align:right;\"> 78 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> NA </td>\n   <td style=\"text-align:right;\"> 131589 </td>\n  </tr>\n</tbody>\n</table>\n\n`````\n:::\n:::\n\n\n\n## Create a map of the census tracts in Houston that lost power\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Import census data\nacs_texas <- st_read(here::here(\"posts/2024-12-09-houston-blackout-visualization\",\n                                \"data\", \"ACS_2019_5YR_TRACT_48_TEXAS.gdb\"), \n                     layer =\"ACS_2019_5YR_TRACT_48_TEXAS\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nReading layer `ACS_2019_5YR_TRACT_48_TEXAS' from data source \n  `/Users/leilanie/git/leirubinstein.github.io/posts/2024-12-09-houston-blackout-visualization/data/ACS_2019_5YR_TRACT_48_TEXAS.gdb' \n  using driver `OpenFileGDB'\nSimple feature collection with 5265 features and 15 fields\nGeometry type: MULTIPOLYGON\nDimension:     XY\nBounding box:  xmin: -106.6456 ymin: 25.83716 xmax: -93.50804 ymax: 36.5007\nGeodetic CRS:  NAD83\n```\n\n\n:::\n\n```{.r .cell-code}\nacs_income <- st_read(here::here(\"posts/2024-12-09-houston-blackout-visualization\",\n                                 \"data\", \"ACS_2019_5YR_TRACT_48_TEXAS.gdb\"), \n                      layer = \"X19_INCOME\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nReading layer `X19_INCOME' from data source \n  `/Users/leilanie/git/leirubinstein.github.io/posts/2024-12-09-houston-blackout-visualization/data/ACS_2019_5YR_TRACT_48_TEXAS.gdb' \n  using driver `OpenFileGDB'\n```\n\n\n:::\n\n```{.r .cell-code}\n# Join the median household income from the previous 12 months to the census tract geometries\nacs <- left_join(acs_income, acs_texas, join_by(GEOID == GEOID_Data)) %>%\n  st_as_sf() %>%\n  st_make_valid() %>%\n  st_transform(crs = \"EPSG:3083\")\n\n# Create a bounding box for the Houston area\nhouston_bbox <- st_bbox(c(xmin = -96.5, xmax = -94.5, \n                          ymin = 29, ymax = 30.5)) %>%\n  st_as_sfc() %>%\n  st_set_crs(4326) %>%\n  st_transform(st_crs(acs))\n\n# Filter to Houston area census tracts\nhouston_tracts <- acs[houston_bbox, ]\n\n# Identify census tracts that contained homes that experienced blackouts\nhouston_tracts_blackouts <- st_filter(houston_tracts, houses_filtered)\n\ntm_shape(houston_tracts) +\n  tm_polygons(col = \"white\", border.col = \"gray\") +\n  tm_shape(houston_tracts_blackouts) +\n  tm_polygons(col = \"#CBC3E3\", border.col = \"black\", lwd = 0.5) +\n  tm_compass(type = \"8star\", position = c(\"right\", \"top\"), size = 0.8) +\n  tm_scale_bar(position = c(\"left\", \"bottom\")) +\n  tm_layout(main.title = \"Census Tracts in Houston that Experienced Blackouts\",\n            main.title.position = \"center\",\n            main.title.size = 1.2,\n            frame = FALSE)\n```\n\n::: {.cell-output-display}\n![](houston-blackouts_files/figure-html/unnamed-chunk-9-1.png){width=672}\n:::\n:::\n\n\n\n## Compare the distributions of median household income for census tracts tnihat did and did not experience blackouts\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Find census tracts that did NOT experience blackouts\nhouston_non_blackout <- houston_tracts %>%\n  filter(!GEOID %in% houston_tracts_blackouts$GEOID)\n\n# Label tracts by power status\nhouston_tracts_blackouts$status <- \"Lost Power\"\nhouston_non_blackout$status <- \"Did Not Lose Power\"\ncombined_tracts <- rbind(houston_tracts_blackouts, houston_non_blackout)\n\n# Reorder the factor levels to put \"Did Not Lose Power\" first\ncombined_tracts$status <- factor(combined_tracts$status, \n                                levels = c(\"Did Not Lose Power\", \"Lost Power\"))\n\n# Plot combined tracts\nggplot(combined_tracts, aes(y = status, x = B19013e1, fill = status)) +\n  geom_boxplot(alpha = 0.8, outlier.alpha = 0.6) +\n  labs(title = \"Distribution of Median Household Income by Power Loss Status\",\n       subtitle = \"Houston Census Tracts During February 2021 Winter Storm\",\n       x = \"Median Household Income (2011 inflation-adjusted dollars)\",\n       y = \"Power Status\",\n       fill = \"Power Status\") +\n  scale_fill_manual(values = c(\"Did Not Lose Power\" = \"lightgreen\", \n                               \"Lost Power\" = \"#CBC3E3\")) +\n  scale_x_continuous(labels = scales::dollar_format()) +\n  theme_bw() +\n  theme(legend.position = \"none\",\n        plot.title = element_text(size = 14, face = \"bold\"),\n        plot.subtitle = element_text(size = 12),\n        axis.title = element_text(size = 11),\n        axis.text = element_text(size = 10))\n```\n\n::: {.cell-output-display}\n![](houston-blackouts_files/figure-html/unnamed-chunk-10-1.png){width=672}\n:::\n:::\n\n\n\n## Reflection\n\nI found that median household income was slightly higher in the census tracts that lost power vs. those that did not lose power. Census tracts on the outskirts of the Houston area generally experienced less power loss, but most of the majority of tracts were still affected. According to [Busby et al.](https://www.sciencedirect.com/science/article/pii/S2214629621001997), all socio-economic groups were affected, but the effects of the storm were harder on low-income families, who live in older, poorly insulated homes and have limited access to resources for repairs and physical health after the storm. \n\n## Data Citations\n\n| Data | Citation | Link |\n|------|----------|------|\n| Night Lights | NASA Earth Data (2024). Level-1 and Atmospheric Archive & Distribution System Distributed Active Archive Center (LAADS DAAC) | [Level-1 and Atmospheric Archive & Distribution System Distributed Active Archive Center (LAADS DAAC).](https://ladsweb.modaps.eosdis.nasa.gov/) |\n| Infrastructure Data | Planet OSM (2024). Retrieved from https://download.geofabrik.de/ | [Link](https://planet.openstreetmap.org/) | \n| Census Data |U.S. Census Bureau. (2019). American Community Survey 1-year Public Use Microdata Samples.  Retrieved from https://www.census.gov/programs-surveys/acs/news/data-releases.2019.html#list-tab-1133175109 | [Link] (https://www.census.gov/programs-surveys/acs/news/data-releases.2019.html#list-tab-1133175109) | \n| Understanding the 2021 Texas Blackout | Busby, J. W., Baker, K., Bazilian, M. D., Gilbert, A. Q., Grubert, E., Rai, V., Rhodes, J. D., Shidore, S., Smith, C. A., & Webber, M. E. (2021). Cascading risks: Understanding the 2021 winter blackout in Texas. Energy Research & Social Science, 77, 102106. https://doi.org/10.1016/j.erss.2021.102106 | [Cascading risks: Understanding the 2021 winter blackout in Texas](https://www.sciencedirect.com/science/article/pii/S2214629621001997)\n\n",
    "supporting": [
      "houston-blackouts_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-in-header": [
        "<script src=\"../../site_libs/kePrint-0.0.1/kePrint.js\"></script>\n<link href=\"../../site_libs/lightable-0.0.1/lightable.css\" rel=\"stylesheet\" />\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}