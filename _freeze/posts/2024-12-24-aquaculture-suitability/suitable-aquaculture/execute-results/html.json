{
  "hash": "1df7819f04a3c897459588ee8f837887",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Aquaculture Suitability Map\"\nauthor: \"Leilanie Rubinstein\"\ndate: \"2024-12-11\"\ncategories: [R, Marine, Geospatial Analysis]\ndescription: \"Determining and visualizing which West Coast EEZs are best suited to developing species-specific marine aquaculture\"\nformat: html\neditor: visual\neditor_options: \n  chunk_output_type: console\nexecute:\n  warning: false\n  message: false\n  freeze: true\ncode-fold: true\ncode-summary: \"show code\"\ncode-tools: true\n---\n\n\n\n# Prioritizing potential aquaculture\n\n## Background\n\nAs global demand for sustainable protein grows, marine aquaculture offers an alternative to land-based meat production. [Gentry et al.](https://www.nature.com/articles/s41559-017-0257-9) found through mapping potential for marine aquaculture using multiple constraints, that global seafood demand could be met using less than 0.015% of global ocean area.\n\nThis exercise determines which Exclusive Economic Zones (EEZ) on the West Coast of the US are best suited to developing marine aquaculture to several species of oysters, and develops a function for visualizing suitability based on a single speciesâ€”*Pteria sterna*, the Pacific winged oysterâ€”in this case.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Load libraries\nlibrary(terra)\nlibrary(sf)\nlibrary(tidyverse)\nlibrary(here)\nlibrary(tmap)\nlibrary(testthat)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n# Source external script that defines a custom function for aquaculture suitability\nsource(here::here(\"posts/2024-12-24-aquaculture-suitability/suitable-aquaculture.R\"))\n```\n:::\n\n\n\n*This function will also be provided below as part of `hwk4.qmd`.*\n\n## Prepare data\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Read in Sea Surface Temperature, Bathymetry, and EEZ data\nfiles <- list.files(here::here(\"posts/2024-12-24-aquaculture-suitability/data\"), pattern = \"average*\", full.names = TRUE)\nsst <- terra::rast(files)\nnames(sst) <- c(2008, 2009, 2010, 2011, 2012)\n\nif (nlyr(sst) == 0) {\n  stop(\"No layers found in SST data\")\n}\n\ndepth <- terra::rast(here::here(\"posts/2024-12-24-aquaculture-suitability/data\", \"depth.tif\")) %>%\n  project(., y = crs(sst))\n\nwc_eez <- st_read(here::here(\"posts/2024-12-24-aquaculture-suitability/data\", \"wc_regions_clean.shp\"), quiet = TRUE) %>%\n  st_transform(., crs = crs(sst))\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n# Check that the CRSs match for the datasets\ntestthat::test_that(\"Coordinate reference systems match\", {\n  expect_equal(crs(sst), crs(depth))\n  expect_equal(crs(depth), crs(wc_eez))\n})\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nTest passed ðŸŽŠ\n```\n\n\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n# Import US state boundaries for plotting\nstates <- st_read(here::here(\"posts/2024-12-24-aquaculture-suitability/data\", \"states\", \"cb_2023_us_state_20m.shp\"), quiet = TRUE) %>%\n  filter(NAME %in% c(\"California\", \"Oregon\", \"Washington\", \"Nevada\")) %>%\n  st_transform(., crs = crs(sst)) %>%\n  st_crop(., st_bbox(wc_eez))\n```\n:::\n\n\n\n## Process data\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsst_mean <- sst %>%\n  terra::mean() %>%\n  - 273.15 # Convert from ÂºK to ÂºC\n\ndepth_cropped <- crop(depth, sst_mean)\n\nif (res(depth_cropped)[1] != res(sst_mean)[1]) {\n  warning(sprintf(\"Resolution mismatch\", \n                  res(depth_cropped)[1], res(sst_mean)[1]))\n}\n\ndepth_resample <- resample(depth_cropped, sst_mean, method = \"near\")\n\next(depth_resample) == ext(sst_mean)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] TRUE\n```\n\n\n:::\n\n```{.r .cell-code}\n# Check that the depth and SST rasters match in resolution, extent, and position\ndepth_sst_stack <- c(depth_resample, sst_mean)\n```\n:::\n\n\n\n## Find suitable locations for marine aquaculture\n\nResearch has shown that oysters need the following conditions for optimal growth:\n\n-   sea surface temperature: 11-30Â°C\n-   depth: 0-70 meters below sea level\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Define reclassification matrices for depth and SST\nrcl_depth <- matrix(c(-Inf, -70, 0,\n                      -70, 0, 1,\n                      0, Inf, 0),\n                    ncol = 3, byrow = TRUE)\nrcl_sst <- matrix(c(-Inf, 11, 0,\n                    11, 30, 1,\n                    30, Inf, 0),\n                  ncol = 3, byrow = TRUE)\n\n# Apply the matrices to the depth and SST rasters, making all cells 0 or 1\ndepth_rcl <- terra::classify(depth_resample, rcl = rcl_depth)\nsst_rcl <- terra::classify(sst_mean, rcl = rcl_sst)\n\n# Find locations that satisfy both SST and depth conditions\nsuitablility <- function(depth_rcl, sst_rcl) {\n  depth_rcl*sst_rcl\n}\nsuitable <- lapp(c(depth_rcl, sst_rcl), fun = suitablility)\n```\n:::\n\n\n\n## Determine the most suitable EEZ\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Set unsuitable locations to NAs\nsuitable[suitable == 0] <- NA\n\n# Find the total suitable area within each EEZ\neez_area <- terra::cellSize(suitable, mask = T, unit = \"km\")\nsuitable_eez_area <- exactextractr::exact_extract(\n  eez_area, wc_eez, \n  fun = \"sum\", \n  append_cols=c(\"rgn\", \"area_km2\"), \n  progress = FALSE)\n\n# Join to original data to obtain geometries for visualization\nsuitable_eez_join <- left_join(wc_eez, suitable_eez_area)\n\ntm_shape(suitable_eez_join) +\n  tm_fill(col = \"sum\",\n          style = \"pretty\",\n          palette = \"Blues\",\n          title = \"Suitable Area (km\\u00b2)\") +\n  tm_text(text = \"rgn\",\n          size = 0.7) +\n  tm_shape(states) +\n  tm_polygons(col = \"#e3d3b8\",\n              border.col = \"#402618\") +\n  tm_shape(wc_eez) +\n  tm_borders(col = \"#402618\") +\n  tm_layout(main.title = paste(\"Suitable Area for Oyster Fisheries \\nin West Coast EEZ\"),\n            bg.color = \"#e8ebea\",\n            legend.bg.color = \"#e3d3b8\",\n            legend.position = c(0.61, 0.85)) +\n  tm_scale_bar(position = c(\"left\", \"bottom\")) +\n  tm_compass(position = c(\"right\", \"bottom\"),\n             size = 2)\n```\n\n::: {.cell-output-display}\n![](suitable-aquaculture_files/figure-html/unnamed-chunk-8-1.png){width=480}\n:::\n:::\n\n\n\n## Single-species analysis function\n\nUsing the provided depth, sea surface temperature, West Coast Exclusive Economic Zones, and states data, we can conduct a suitability analysis and produce a suitability map for any species of interest for marine aquaculture given their **sea surface temperature range**, **depth range** and **species name**.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsuitable_aquaculture <- function(min_temp, max_temp, min_depth, max_depth, species) {\n  # Read and prepare data\n  files <- list.files(here::here(\"posts/2024-12-24-aquaculture-suitability/data\"), pattern = \"average*\", full.names = TRUE)\n  sst <- terra::rast(files)\n  names(sst) <- c(2008, 2009, 2010, 2011, 2012)\n  \n  # Import bathymetry data\n  depth <- terra::rast(here::here(\"posts/2024-12-24-aquaculture-suitability/data\", \"depth.tif\"))\n  \n  # Import EEZ and state boundaries\n  wc_eez <- st_read(here::here(\"posts/2024-12-24-aquaculture-suitability/data\", \"wc_regions_clean.shp\"), quiet = TRUE) %>%\n    st_transform(., crs = crs(sst))\n  \n  states <- st_read(here::here(\"posts/2024-12-24-aquaculture-suitability/data\", \"states\", \"cb_2023_us_state_20m.shp\"), quiet = TRUE) %>%\n    filter(NAME %in% c(\"California\", \"Oregon\", \"Washington\", \"Nevada\")) %>%\n    st_transform(., crs = crs(sst)) %>%\n    st_crop(., st_bbox(wc_eez))\n  \n  # Process SST data\n  sst_mean <- sst %>%\n    terra::mean() %>%\n    - 273.15  # Convert from Kelvin to Celsius\n  \n  # Process depth data\n  depth <- project(depth, y = crs(sst))\n  depth_cropped <- crop(depth, sst_mean)\n  depth_resample <- resample(depth_cropped, sst_mean, method = \"near\")\n  \n  # Create reclassification matrices\n  rcl_depth <- matrix(c(-Inf, -max_depth, 0,\n                        -max_depth, min_depth, 1,\n                        min_depth, Inf, 0),\n                      ncol = 3, byrow = TRUE)\n  rcl_sst <- matrix(c(-Inf, min_temp, 0,\n                      min_temp, max_temp, 1,\n                      max_temp, Inf, 0),\n                    ncol = 3, byrow = TRUE)\n  \n  # Apply matrices to depth and SST rasters\n  depth_rcl <- terra::classify(depth_resample, rcl = rcl_depth)\n  sst_rcl <- terra::classify(sst_mean, rcl = rcl_sst)\n  \n  # Find locations that satisfy both SST and depth conditions\n  suitablility <- function(depth_rcl, sst_rcl) {\n    depth_rcl*sst_rcl\n  }\n  suitable <- lapp(c(depth_rcl, sst_rcl), fun = suitablility)\n  \n  # Set unsuitable locations to NA\n  suitable[suitable == 0] <- NA\n  \n  # Find the total suitable area within each EEZ\n  eez_area <- terra::cellSize(suitable, mask = T, unit = \"km\")\n  suitable_eez_area <- exactextractr::exact_extract(eez_area, wc_eez, \n                                                    fun = \"sum\", \n                                                    append_cols=c(\"rgn\", \"area_km2\"), \n                                                    progress = FALSE)\n  \n  # Join to original data to obtain geometries for visualization\n  suitable_eez_join <- left_join(wc_eez, suitable_eez_area, by = join_by(rgn, area_km2))\n  \n  # Visualize suitable area\n  tm_shape(suitable_eez_join) +\n    tm_fill(col = \"sum\",\n            style = \"pretty\",\n            palette = \"Blues\",\n            title = \"Suitable Area (km\\u00b2)\") +\n    tm_text(text = \"rgn\",\n            size = 0.7) +\n    tm_shape(states) +\n    tm_polygons(col = \"#e3d3b8\",\n                border.col = \"#402618\") +\n    tm_shape(wc_eez) +\n    tm_borders(col = \"#402618\") +\n    tm_layout(main.title = paste(\"Suitable Area for\", \n                                 species,\n                                 \"\\nFisheries in West Coast EEZ\"),\n              bg.color = \"#e8ebea\",\n              legend.bg.color = \"#e3d3b8\",\n              legend.position = c(0.61, 0.85)) +\n    tm_scale_bar(position = c(\"left\", \"bottom\")) +\n    tm_compass(position = c(\"right\", \"bottom\"),\n               size = 2)\n}\n```\n:::\n\n\n\n## Test function for single oyster species\n\n[*Pteria sterna*](https://www.sealifebase.ca/summary/Pteria-sterna.html) or the [Pacific wing-oyster](https://www.thesandiegoshellclub.com/uploads/1/3/8/1/138179831/tuskes_-_pteria_article.pdf) is an eastern Pacific oyster of commercial value.\n\nConditions for optimal growth:\n\n-   sea surface temperature: 10-30Â°C\n-   depth: 3-26 meters below sea level\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsuitable_aquaculture(10, 30, 3, 26, \"Pteria sterna\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\n|---------|---------|---------|---------|\n=========================================\n                                          \n```\n\n\n:::\n\n::: {.cell-output-display}\n![](suitable-aquaculture_files/figure-html/unnamed-chunk-10-1.png){width=480}\n:::\n:::\n\n\n\n# Data Citations\n\n| Data | Citation | Link |\n|------------------------|------------------------|------------------------|\n| Sea Surface Temperature | NOAA Coral Reef Watch (2018). NOAA Coral Reef Watch Daily Global 5-km Satellite Sea Surface Temperature Anomaly Product v3.1 | <https://coralreefwatch.noaa.gov/product/5km/index_5km_ssta.php> |\n| Bathymetry | GEBCO Compilation Group (2022) GEBCO_2022 Grid (doi:10.5285/e0f0bb80-ab44-2739-e053-6c86abc0289c) | <https://www.gebco.net/data_and_products/gridded_bathymetry_data/#area> |\n| EEZ Boundaries | Marine Regions - Maritime Boundaries and Exclusive Economic Zones, 2019 | <https://www.marineregions.org/eez.php> |\n| State Boundaries | U.S. Census Bureau TIGER/Line Shapefiles, 2023 | <https://www.census.gov/geographies/mapping-files/time-series/geo/tiger-line-file.html> |\n",
    "supporting": [
      "suitable-aquaculture_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}